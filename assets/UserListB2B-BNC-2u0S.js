import{r as a,j as e,L as M}from"./index-B9EhzTRJ.js";import{G as X}from"./users-D9z95VUr.js";import Y from"./B2BView-CojcwXdg.js";import{C as ee}from"./ConvertB2CButton-CNXSOgeL.js";const ne=()=>{const[f,S]=a.useState([]),[r,m]=a.useState(1),[u,$]=a.useState(1),[g,P]=a.useState(!1),[D,k]=a.useState(!0),[F,V]=a.useState(!1),[I,R]=a.useState(),[o,B]=a.useState(""),[t,L]=a.useState(""),[l,A]=a.useState(""),[y,J]=a.useState(""),[n,T]=a.useState("all"),[i,U]=a.useState("all"),[W,G]=a.useState(0),[v,E]=a.useState(),Q=async()=>{const s=await localStorage.getItem("adminData");try{const d=s?JSON.parse(s):null;E(d.admin)}catch(d){console.error("Failed to parse admin data:",d),E(null)}};a.useEffect(()=>{Q()},[]),a.useEffect(()=>{h(r,o,t,l,n,i)},[r]);const h=async(s,d="",x="",j="",b="all",p="all")=>{try{P(!0);const N={page:s,...d&&{search:d},...x&&{startDate:x},...j&&{endDate:j},...b!=="all"&&{companyVerified:b==="verified"},...p!=="all"&&{jobPostStatus:p==="created"}},c=await X(N);if(console.log(c,"resssss"),c.success){S(c.data);const H=c.totalPages||1;$(H),G(c.total)}else console.error("Failed to fetch users:",c.message||"Unknown error")}catch(N){console.error("Error fetching B2B users:",N)}finally{P(!1)}},_=()=>{r>1&&m(s=>s-1)},K=()=>{r<u&&m(s=>s+1)},O=s=>{s.preventDefault(),m(1),h(1,y,t,l,n,i),B(y)},Z=()=>{J(""),B(""),L(""),A(""),T("all"),U("all"),m(1),h(1,"","","","all","all")},q=()=>{m(1),h(1,o,t,l,n,i)},C=s=>{T(s),m(1),h(1,o,t,l,s,i)},w=s=>{U(s),m(1),h(1,o,t,l,n,s)},z=s=>{R(s),k(!1),V(!0)};return e.jsxs(e.Fragment,{children:[D&&!F&&e.jsx("div",{className:"page-wrapper",children:e.jsx("div",{className:"content",children:e.jsxs("div",{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"B2B Users List"}),(o||t||l||n!=="all"||i!=="all")&&e.jsxs("div",{className:"active-filters",children:[e.jsx("span",{className:"badge bg-light text-dark me-2",children:"Active Filters:"}),o&&e.jsxs("span",{className:"badge bg-info me-2",children:['Search: "',o,'"']}),t&&e.jsxs("span",{className:"badge bg-info me-2",children:["From: ",new Date(t).toLocaleDateString()]}),l&&e.jsxs("span",{className:"badge bg-info me-2",children:["To: ",new Date(l).toLocaleDateString()]}),n!=="all"&&e.jsxs("span",{className:"badge bg-info me-2",children:["Company: ",n==="verified"?"Verified":"Not Verified"]}),i!=="all"&&e.jsxs("span",{className:"badge bg-info me-2",children:["Job Posts: ",i==="created"?"Created":"Not Created"]}),e.jsxs("button",{className:"btn btn-sm btn-outline-danger",onClick:Z,children:[e.jsx("i",{className:"fas fa-times me-1"}),"Clear All"]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("form",{onSubmit:O,className:"d-flex",children:[e.jsx("input",{type:"text",className:"form-control me-2",placeholder:"Search by name, phone, email...",value:y,onChange:s=>J(s.target.value)}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx("i",{className:"fas fa-search me-1"}),"Search"]})]}),e.jsx("small",{className:"text-muted",children:"Search by business owner name, phone number, email or city"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-5",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"startDate",className:"form-label small",children:"Registration From"}),e.jsx("input",{type:"date",id:"startDate",className:"form-control",value:t,onChange:s=>L(s.target.value)})]})}),e.jsx("div",{className:"col-md-5",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"endDate",className:"form-label small",children:"Registration To"}),e.jsx("input",{type:"date",id:"endDate",className:"form-control",value:l,onChange:s=>A(s.target.value)})]})}),e.jsx("div",{className:"col-md-2 d-flex align-items-end",children:e.jsx("button",{className:"btn btn-secondary w-100",onClick:q,disabled:!t&&!l,children:e.jsx("i",{className:"fas fa-filter"})})})]})})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-light",children:e.jsx("div",{className:"card-body py-2",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("span",{className:"fw-medium",children:"Company Status:"})}),e.jsx("div",{className:"col-md-9",children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",className:`btn ${n==="all"?"btn-primary":"btn-outline-primary"}`,onClick:()=>C("all"),children:"All Users"}),e.jsxs("button",{type:"button",className:`btn ${n==="verified"?"btn-primary":"btn-outline-primary"}`,onClick:()=>C("verified"),children:[e.jsx("i",{className:"fas fa-check-circle me-1"}),"With Verified Company"]}),e.jsxs("button",{type:"button",className:`btn ${n==="notVerified"?"btn-primary":"btn-outline-primary"}`,onClick:()=>C("notVerified"),children:[e.jsx("i",{className:"fas fa-times-circle me-1"}),"No Verified Company"]})]})})]})})})})}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-light",children:e.jsx("div",{className:"card-body py-2",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("span",{className:"fw-medium",children:"Job Post Status:"})}),e.jsx("div",{className:"col-md-9",children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",className:`btn ${i==="all"?"btn-success":"btn-outline-success"}`,onClick:()=>w("all"),children:"All Users"}),e.jsxs("button",{type:"button",className:`btn ${i==="created"?"btn-success":"btn-outline-success"}`,onClick:()=>w("created"),children:[e.jsx("i",{className:"fas fa-briefcase me-1"}),"With Job Posts"]}),e.jsxs("button",{type:"button",className:`btn ${i==="notCreated"?"btn-success":"btn-outline-success"}`,onClick:()=>w("notCreated"),children:[e.jsx("i",{className:"fas fa-ban me-1"}),"No Job Posts"]})]})})]})})})})})]})})}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("h4",{style:{textAlign:"center",fontWeight:"800",paddingTop:10,paddingBottom:25},children:["Total Count - ",W]}),g?e.jsxs("div",{className:"text-center my-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading business owners..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table border-0 custom-table comman-table datatable mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"Company Name"}),e.jsx("th",{children:"Registration Date"}),e.jsx("th",{children:"Companies"}),e.jsx("th",{children:"Job Posts"}),e.jsx("th",{children:"Action"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:f.length>0?f.map((s,d)=>{var b;const x=s.companies?s.companies.reduce((p,N)=>{var c;return p+(((c=N.jobs)==null?void 0:c.length)||0)},0):0,j=s.company&&s.company.length>0;return e.jsxs("tr",{children:[e.jsx("td",{children:(r-1)*20+d+1}),e.jsx("td",{children:e.jsx("div",{className:"fw-bold",children:s.name||"-"})}),e.jsx("td",{children:s.phoneNumber||"-"}),e.jsx("td",{children:((b=s==null?void 0:s.companies[0])==null?void 0:b.companyName)||"-"}),e.jsx("td",{children:s.createdAt?new Date(s.createdAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"-"}),e.jsx("td",{children:j?e.jsxs("span",{className:"badge bg-success",children:[e.jsx("i",{className:"fas fa-building me-1"})," ",s.company.length]}):e.jsxs("span",{className:"badge bg-warning",children:[e.jsx("i",{className:"fas fa-times-circle me-1"})," Not Verified"]})}),e.jsx("td",{children:x>0?e.jsxs("span",{className:"badge bg-info",children:[e.jsx("i",{className:"fas fa-briefcase me-1"})," ",x]}):e.jsx("span",{className:"badge bg-secondary",children:"0"})}),e.jsx("td",{onClick:()=>z(s),children:e.jsxs(M,{className:"btn btn-sm btn-primary",children:[e.jsx("i",{className:"fas fa-eye me-1"})," View"]})}),(v==null?void 0:v.isEdit)&&e.jsx("td",{children:j?"":e.jsx(ee,{userId:s==null?void 0:s._id,fetchUsers:h,role:"B2C"})})]},s._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"text-center",children:e.jsxs("div",{className:"py-4",children:[e.jsx("i",{className:"fas fa-user-tie fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No business owners found"}),(o||t||l||n!=="all"||i!=="all")&&e.jsx("p",{children:"Try adjusting your search criteria or clear filters"})]})})})})]})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:_,disabled:r===1||g,children:[e.jsx("i",{className:"fas fa-chevron-left me-1"})," Previous"]}),e.jsxs("div",{className:"pagination-info",children:[e.jsxs("span",{className:"fw-bold",children:["Page ",r," of ",u]}),e.jsxs("div",{className:"text-muted small",children:["Showing ",f.length," of ",u*20," business owners"]})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:K,disabled:r>=u||g,children:["Next ",e.jsx("i",{className:"fas fa-chevron-right ms-1"})]})]})]})})}),F&&!D&&e.jsx(Y,{user:I,setListPage:k,setViewPage:V,users:f,setUsers:S})]})};export{ne as default};
