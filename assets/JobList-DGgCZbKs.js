import{r,j as e,L as V}from"./index-C1KJvdm4.js";import{p as G}from"./user-CZs_HDyx.js";import{i as H}from"./axiosInstance-BYKqn8JH.js";const K=async a=>{try{let t=`page=${a.page}`;return a.search&&(t+=`&search=${encodeURIComponent(a.search)}`),a.startDate&&(t+=`&startDate=${encodeURIComponent(a.startDate)}`),a.endDate&&(t+=`&endDate=${encodeURIComponent(a.endDate)}`),a.paymentStatus&&(t+=`&paymentStatus=${encodeURIComponent(a.paymentStatus)}`),a.sortBy&&(t+=`&sortBy=${encodeURIComponent(a.sortBy)}`),a.sortOrder&&(t+=`&sortOrder=${encodeURIComponent(a.sortOrder)}`),(await H.get(`admin/jobPostList?${t}`)).data}catch(t){return t.response?t.response.data:t.request?{success:!1,message:"No response received from server"}:{success:!1,message:t.message||"Error occurred while making the request"}}},M=()=>{const[a,t]=r.useState([]),[d,h]=r.useState(1),[y,R]=r.useState(1),[w,P]=r.useState(!1),[o,C]=r.useState(""),[c,F]=r.useState(""),[i,L]=r.useState(""),[D,A]=r.useState(""),[n,I]=r.useState(""),[l,k]=r.useState(""),[x,$]=r.useState("desc");r.useEffect(()=>{u(d,o,c,i,n,l,x)},[d]);const u=async(s,m="",N="",g="",f="",p="",v="desc")=>{try{P(!0);const j={page:s,...m&&{search:m},...N&&{startDate:N},...g&&{endDate:g},...f&&{paymentStatus:f},...p&&{sortBy:p},...v&&{sortOrder:v}};console.log("Fetching with params:",j);const b=await K(j);if(b.success){t(b.data);const S=b.totalPages||1;R(S)}else console.error("Failed to fetch jobs:",b.message||"Unknown error")}catch(j){console.error("Error fetching job posts:",j)}finally{P(!1)}},O=()=>{d>1&&h(s=>s-1)},E=()=>{d<y&&h(s=>s+1)},T=s=>{s.preventDefault(),h(1),u(1,D,c,i,n,l,x),C(D)},J=()=>{A(""),C(""),F(""),L(""),I(""),k(""),$("desc"),h(1),u(1,"","","","","","desc")},B=()=>{h(1),u(1,o,c,i,n,l,x)},U=s=>{h(1),I(s),u(1,o,c,i,s,l,x)},q=s=>{let m="desc";l===s&&(m=x==="desc"?"asc":"desc"),k(s),$(m),h(1),u(1,o,c,i,n,s,m)},Q=s=>l!==s?e.jsx("i",{className:"fas fa-sort text-muted ms-1"}):x==="desc"?e.jsx("i",{className:"fas fa-sort-down ms-1"}):e.jsx("i",{className:"fas fa-sort-up ms-1"});return e.jsx("div",{className:"page-wrapper",children:e.jsx("div",{className:"content",children:e.jsxs("div",{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"Job Post List"}),(o||c||i||n||l)&&e.jsxs("div",{className:"active-filters",children:[e.jsx("span",{className:"badge bg-light text-dark me-2",children:"Active Filters:"}),o&&e.jsxs("span",{className:"badge bg-info me-2",children:['Search: "',o,'"']}),c&&e.jsxs("span",{className:"badge bg-info me-2",children:["From: ",new Date(c).toLocaleDateString()]}),i&&e.jsxs("span",{className:"badge bg-info me-2",children:["To: ",new Date(i).toLocaleDateString()]}),n&&e.jsxs("span",{className:"badge bg-info me-2",children:["Payment: ",n==="paid"?"Paid":"Unpaid"]}),l&&e.jsxs("span",{className:"badge bg-primary me-2",children:["Sorted by: ",l==="applicants"?"Applicants":l," (",x==="desc"?"Highest First":"Lowest First",")"]}),e.jsxs("button",{className:"btn btn-sm btn-outline-danger",onClick:J,children:[e.jsx("i",{className:"fas fa-times me-1"}),"Clear All"]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("form",{onSubmit:T,className:"d-flex",children:[e.jsx("input",{type:"text",className:"form-control me-2",placeholder:"Search job title, company, business owner...",value:D,onChange:s=>A(s.target.value)}),e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx("i",{className:"fas fa-search me-1"}),"Search"]})]}),e.jsx("small",{className:"text-muted",children:"Search across job titles, descriptions, company names, or business owner details"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"startDate",className:"form-label small",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",className:"form-control",value:c,onChange:s=>F(s.target.value)})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"endDate",className:"form-label small",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",className:"form-control",value:i,onChange:s=>L(s.target.value)})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label small",children:"Payment Status"}),e.jsxs("div",{className:"btn-group w-100",children:[e.jsx("button",{type:"button",className:`btn btn-sm ${n==="paid"?"btn-success":"btn-outline-success"}`,onClick:()=>U(n==="paid"?"":"paid"),children:"Paid"}),e.jsx("button",{type:"button",className:`btn btn-sm ${n==="unpaid"?"btn-warning":"btn-outline-warning"}`,onClick:()=>U(n==="unpaid"?"":"unpaid"),children:"Unpaid"})]})]})}),e.jsx("div",{className:"col-12 mt-2",children:e.jsxs("button",{className:"btn btn-secondary",onClick:B,disabled:!c&&!i,children:[e.jsx("i",{className:"fas fa-filter me-1"}),"Apply Date Filter"]})})]})})]})]})})}),e.jsx("div",{className:"row mt-3",children:w?e.jsxs("div",{className:"text-center my-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading job posts..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table border-0 comman-table datatable mb-0",style:{width:"100%",tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Job Title"}),e.jsx("th",{children:"Business Owner"}),e.jsx("th",{children:"Phone Number"}),e.jsxs("th",{className:"cursor-pointer",onClick:()=>q("applicants"),children:["Applicants ",Q("applicants")]}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:a&&a.length>0?a.map((s,m)=>{var N,g,f,p,v,j,b,S;return e.jsxs("tr",{children:[e.jsx("td",{children:(d-1)*20+m+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:((N=s==null?void 0:s.companyId)==null?void 0:N.companyLogo)||G,alt:"",height:40,width:40,style:{borderRadius:"50%",marginRight:"10px"}}),e.jsx("p",{className:"mb-0",children:((g=s==null?void 0:s.companyId)==null?void 0:g.companyName)||"N/A"})]})}),e.jsx("td",{children:e.jsx("p",{className:"mb-0",children:((f=s==null?void 0:s.branchData)==null?void 0:f.address)||"N/A"})}),e.jsx("td",{children:((p=s==null?void 0:s.jobTitle)==null?void 0:p.title)||"N/A"}),e.jsx("td",{children:((v=s==null?void 0:s.userId)==null?void 0:v.name)||"-"}),e.jsx("td",{children:((j=s==null?void 0:s.userId)==null?void 0:j.phoneNumber)||"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:((S=(b=s==null?void 0:s.applicants)==null?void 0:b.applicants)==null?void 0:S.length)||0})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s!=null&&s.paymentDone?"bg-success":"bg-warning"}`,children:(s==null?void 0:s.paymentDone)===!0?"Paid":"Unpaid"})}),e.jsx("td",{children:s.createdAt?new Date(s.createdAt).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"-"}),e.jsx("td",{children:e.jsx(V,{to:"/jobView",state:{post:s},className:"btn btn-sm btn-primary",children:"View"})})]},s._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center",children:e.jsxs("div",{className:"py-4",children:[e.jsx("i",{className:"fas fa-file-search fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No job posts found"}),(o||c||i||n||l)&&e.jsx("p",{children:"Try adjusting your search criteria or clear filters"})]})})})})]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:O,disabled:d===1||w,children:[e.jsx("i",{className:"fas fa-chevron-left me-1"})," Previous"]}),e.jsxs("div",{className:"pagination-info",children:[e.jsxs("span",{className:"fw-bold",children:["Page ",d," of ",y]}),e.jsxs("div",{className:"text-muted small",children:["Showing ",a.length," of ",y*20," job posts"]})]}),e.jsxs("button",{className:"btn btn-secondary",onClick:E,disabled:d>=y||w,children:["Next ",e.jsx("i",{className:"fas fa-chevron-right ms-1"})]})]})]})})})};export{M as default};
